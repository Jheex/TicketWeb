document.addEventListener("DOMContentLoaded", () => {
    // Refer√™ncias aos elementos do DOM
    const chatForm = document.getElementById("chat-form");
    const sendBtn = document.getElementById("send-btn");
    const userInput = document.getElementById("user-input");
    const chatMessages = document.getElementById("chat-messages");
    const suggestionButtonsContainer = document.getElementById("suggestion-buttons");

    // Array de sugest√µes de perguntas
    const suggestions = [
        "Como criar usu√°rio?",
        "Onde vejo os relat√≥rios?",
        "Como alterar minha senha?",
        "O que √© um KPI?"
    ];

    // Array de respostas do chatbot
    const responses = [
        { keywords: ["oi", "ol√°", "ola", "oi tudo bem", "e a√≠"], reply: ["Ol√°! Em que posso te ajudar hoje?", "Oi, tudo bem? Pode perguntar!", "Ol√°! O que voc√™ gostaria de saber?"] },
        { keywords: ["tchau", "at√© logo", "adeus", "obrigado"], reply: ["Fico feliz em ter ajudado! Se precisar de algo, √© s√≥ me chamar.", "At√© a pr√≥xima!", "Por nada! Volte sempre que precisar."] },
        { keywords: ["obrigado", "valeu", "show", "muito bom"], reply: "De nada! Fico feliz em ajudar." },
        { keywords: ["como criar usu√°rio", "como adicionar usuario", "adicionar novo usuario"], reply: "Para criar um novo usu√°rio, clique no bot√£o ‚ûï **Novo Usu√°rio** no topo da lista. Preencha os dados e salve." },
        { keywords: ["como editar usuario", "como alterar dados"], reply: "Para editar um usu√°rio, localize-o na tabela e clique no bot√£o de edi√ß√£o (geralmente um l√°pis ‚úèÔ∏è)." },
        { keywords: ["como excluir usuario", "remover usuario", "apagar usuario"], reply: "Voc√™ pode remover um usu√°rio clicando no bot√£o 'Remover' (geralmente um √≠cone de lixeira üóëÔ∏è) na linha da tabela correspondente." },
        { keywords: ["como alterar senha", "mudar senha"], reply: "Se precisar alterar a senha, v√° na tela de edi√ß√£o do seu usu√°rio e preencha o campo de senha com uma nova combina√ß√£o." },
        { keywords: ["permissoes de usuario", "acesso restrito", "acessos"], reply: "O sistema permite definir diferentes n√≠veis de acesso e permiss√µes para cada usu√°rio, como administrador, analista ou visualizador. Verifique as configura√ß√µes de cada usu√°rio." },
        { keywords: ["como ver relat√≥rios", "onde ver relat√≥rios", "relatorios"], reply: "Para ver os relat√≥rios, navegue at√© o menu **Dashboard**. L√° voc√™ pode usar os filtros para visualizar dados de chamados, como status, prioridade e analista." },
        { keywords: ["como criar chamado", "novo chamado"], reply: "A cria√ß√£o de novos chamados √© feita atrav√©s do bot√£o 'Novo Chamado' na tela principal de chamados." },
        { keywords: ["o que √© um kpi", "o que √© kpi"], reply: "KPI significa Indicador-Chave de Desempenho (Key Performance Indicator). No Dashboard, os KPIs mostram as m√©tricas mais importantes para a gest√£o de chamados, como tempo m√©dio de resposta ou n√∫mero de chamados fechados." },
        { keywords: ["email", "e-mail"], reply: "O e-mail do usu√°rio √© uma informa√ß√£o obrigat√≥ria para login e pode ser alterado na tela de edi√ß√£o do usu√°rio." },
        { keywords: ["dashboard", "o que √© dashboard"], reply: "O Dashboard √© a tela principal de relat√≥rios e m√©tricas. Ele oferece uma vis√£o geral do desempenho do seu sistema." },
        { keywords: ["lista", "tabela", "paginacao"], reply: "As tabelas de dados mostram as informa√ß√µes do sistema. Use a pagina√ß√£o na parte inferior para navegar entre as p√°ginas de resultados." },
        { keywords: ["fallback"], reply: "Desculpe, n√£o entendi. Por favor, tente perguntar de outra forma, como 'como criar usu√°rio' ou 'o que √© dashboard'." },

        // Sauda√ß√µes e despedidas (j√° existentes, mas reconfirmadas)
        { keywords: ["oi", "ol√°", "ola", "oi tudo bem", "e a√≠"], reply: ["Ol√°! Em que posso te ajudar hoje?", "Oi, tudo bem? Pode perguntar!", "Ol√°! O que voc√™ gostaria de saber?"] },
        { keywords: ["tchau", "at√© logo", "adeus", "obrigado"], reply: ["Fico feliz em ter ajudado! Se precisar de algo, √© s√≥ me chamar.", "At√© a pr√≥xima!", "Por nada! Volte sempre que precisar."] },
        { keywords: ["obrigado", "valeu", "show", "muito bom"], reply: "De nada! Fico feliz em ajudar." },

        // Usu√°rios e Acesso
        { keywords: ["como criar usuario", "como adicionar usuario", "adicionar novo usuario"], reply: "Para criar um novo usu√°rio, clique no bot√£o ‚ûï **Novo Usu√°rio** no topo da lista. Preencha os dados e salve." },
        { keywords: ["como editar usuario", "como alterar dados"], reply: "Para editar um usu√°rio, localize-o na tabela e clique no bot√£o de edi√ß√£o (geralmente um l√°pis ‚úèÔ∏è)." },
        { keywords: ["como excluir usuario", "remover usuario", "apagar usuario"], reply: "Voc√™ pode remover um usu√°rio clicando no bot√£o 'Remover' (geralmente um √≠cone de lixeira üóëÔ∏è) na linha da tabela correspondente." },
        { keywords: ["como alterar senha", "mudar senha"], reply: "Se precisar alterar a senha, v√° na tela de edi√ß√£o do seu usu√°rio e preencha o campo de senha com uma nova combina√ß√£o." },
        { keywords: ["permissoes de usuario", "acesso restrito", "acessos"], reply: "O sistema permite definir diferentes n√≠veis de acesso e permiss√µes para cada usu√°rio, como administrador, analista ou visualizador. Verifique as configura√ß√µes de cada usu√°rio." },
        { keywords: ["perfil", "dados", "cadastro", "meu perfil"], reply: "Para visualizar ou editar seu perfil, clique no seu nome no canto superior direito da tela e selecione a op√ß√£o 'Meu Perfil'." },
        { keywords: ["privilegio", "grupo de usuario"], reply: "Privil√©gios e grupos de usu√°rios definem o que cada pessoa pode ou n√£o fazer no sistema. Eles s√£o configurados na tela de edi√ß√£o do usu√°rio." },
        { keywords: ["login", "entrar no sistema"], reply: "Seu login √© o seu e-mail. Para entrar no sistema, use seu e-mail e a sua senha." },
        { keywords: ["recuperar senha", "esqueci a senha"], reply: "Ainda n√£o posso te ajudar a recuperar a senha, mas voc√™ pode pedir ao seu administrador para reset√°-la para voc√™." },
        { keywords: ["usuario bloqueado", "acesso bloqueado"], reply: "Se seu usu√°rio estiver bloqueado, entre em contato com um administrador do sistema para que ele possa reativar sua conta." },
        { keywords: ["historico de usuario"], reply: "O hist√≥rico de um usu√°rio mostra todas as a√ß√µes que ele realizou. Voc√™ pode verificar essa informa√ß√£o na tela de detalhes do usu√°rio." },
        { keywords: ["quem √© o administrador", "contato do administrador"], reply: "O administrador √© a pessoa com acesso total ao sistema. Verifique com sua equipe quem possui este cargo." },
        { keywords: ["usuario inativo"], reply: "Um usu√°rio inativo n√£o pode acessar o sistema. Esta op√ß√£o √© usada para desabilitar o acesso sem deletar a conta permanentemente." },
        { keywords: ["nome de usuario", "alterar nome"], reply: "Voc√™ pode alterar o nome do usu√°rio na tela de edi√ß√£o. Basta preencher o novo nome e salvar." },
        { keywords: ["desativar conta"], reply: "Para desativar uma conta, acesse a tela de edi√ß√£o do usu√°rio e mude o status para 'inativo'." },

        // Chamados e Tickets
        { keywords: ["abrir chamado", "novo chamado", "solicitacao", "novo ticket"], reply: "Para abrir um novo chamado, v√° at√© a tela principal de chamados e clique no bot√£o 'Novo Chamado'. Descreva o problema e clique em enviar." },
        { keywords: ["status do chamado", "chamado em andamento"], reply: "Voc√™ pode ver o status de qualquer chamado na tabela principal. Os status s√£o: 'Em andamento', 'Pendente', 'Resolvido' e 'Fechado'." },
        { keywords: ["prioridade do chamado"], reply: "A prioridade indica a urg√™ncia do chamado. Os n√≠veis s√£o: 'Alta', 'M√©dia' e 'Baixa'." },
        { keywords: ["como atribuir um chamado"], reply: "Para atribuir um chamado a um analista, selecione o chamado na lista e altere o campo 'Analista Respons√°vel'." },
        { keywords: ["fila de chamados", "fila"], reply: "A fila de chamados √© uma lista de todos os tickets que ainda n√£o foram atribu√≠dos a um analista. Voc√™ pode acess√°-la na tela de chamados." },
        { keywords: ["o que √© sla", "prazo do chamado"], reply: "SLA (Service Level Agreement) √© o tempo m√°ximo que um chamado tem para ser resolvido. Ele √© definido de acordo com a prioridade do chamado." },
        { keywords: ["resolver problema", "solu√ß√£o do chamado"], reply: "Ap√≥s encontrar a solu√ß√£o, voc√™ pode atualizar o chamado para o status 'Resolvido' e descrever os passos na se√ß√£o de coment√°rios." },
        { keywords: ["como fechar um chamado"], reply: "Um chamado √© fechado ap√≥s a solu√ß√£o ser confirmada. O analista pode fechar o chamado, ou o sistema pode fech√°-lo automaticamente." },
        { keywords: ["anexar arquivo", "colocar anexo"], reply: "Para anexar arquivos, como prints ou documentos, use a op√ß√£o 'Anexar' que fica dentro do chamado." },
        { keywords: ["comentario no chamado"], reply: "Os coment√°rios permitem registrar as intera√ß√µes e o progresso do chamado. Voc√™ pode adicionar um novo coment√°rio a qualquer momento." },
        { keywords: ["filtrar chamados"], reply: "Voc√™ pode filtrar os chamados por status, prioridade, analista respons√°vel, ou data de cria√ß√£o. Os filtros ficam no topo da tela de chamados." },
        { keywords: ["buscar chamado"], reply: "Use a barra de busca no topo da tela para encontrar um chamado espec√≠fico pelo seu ID ou t√≠tulo." },
        { keywords: ["tempo de resposta"], reply: "O tempo de resposta √© a m√©trica que mede quanto tempo um analista leva para dar a primeira resposta ap√≥s a abertura do chamado." },
        { keywords: ["chamados abertos"], reply: "A quantidade de chamados abertos indica a carga de trabalho atual da equipe. Voc√™ pode ver esta m√©trica no Dashboard." },

        // Relat√≥rios e Dashboard
        { keywords: ["relatorio", "relatorios", "metrica", "kpi"], reply: "Os relat√≥rios e m√©tricas do sistema est√£o dispon√≠veis no menu Dashboard. Voc√™ pode usar os filtros para encontrar as informa√ß√µes que precisa." },
        { keywords: ["graficos", "grafico"], reply: "O Dashboard exibe gr√°ficos de barras, pizza e linhas para visualizar o volume de chamados por analista, status e prioridade." },
        { keywords: ["resumo de chamados"], reply: "O resumo de chamados √© uma vis√£o geral que mostra o n√∫mero total de chamados abertos, resolvidos e fechados em um determinado per√≠odo." },
        { keywords: ["tempo medio de atendimento", "tma"], reply: "O TMA (Tempo M√©dio de Atendimento) √© uma m√©trica que indica a m√©dia de tempo que a equipe leva para resolver os chamados." },
        { keywords: ["relatorio por analista"], reply: "Voc√™ pode gerar relat√≥rios de desempenho para cada analista, visualizando a quantidade de chamados que ele resolveu e o seu tempo m√©dio de resposta." },
        { keywords: ["relatorio por status"], reply: "Este relat√≥rio mostra a distribui√ß√£o de chamados por status, ajudando a identificar gargalos no processo." },
        { keywords: ["relatorio semanal", "relatorio mensal", "relatorio anual"], reply: "Voc√™ pode filtrar os relat√≥rios por per√≠odos de tempo como semana, m√™s ou ano para analisar tend√™ncias." },
        { keywords: ["exportar relatorio", "baixar relatorio"], reply: "Voc√™ pode exportar os relat√≥rios em formatos como PDF e Excel atrav√©s do bot√£o 'Exportar' na tela do Dashboard." },
        { keywords: ["tendencias"], reply: "Analisar tend√™ncias de chamados ajuda a prever a demanda e alocar recursos de forma mais eficiente." },
        { keywords: ["volume de chamados"], reply: "O volume de chamados mostra a quantidade de solicita√ß√µes que o sistema recebeu em um determinado per√≠odo. √â um KPI fundamental." },
        { keywords: ["analise de dados"], reply: "A an√°lise de dados do Dashboard ajuda a tomar decis√µes estrat√©gicas para melhorar a efici√™ncia do seu fluxo de trabalho." },

        // Sistema e Funcionalidades Gerais
        { keywords: ["sistema", "plataforma"], reply: "A plataforma InovaTech √© uma solu√ß√£o completa para a gest√£o de chamados e relacionamento com o cliente." },
        { keywords: ["navegacao", "menu"], reply: "O menu de navega√ß√£o est√° no lado esquerdo da tela. Clique em cada √≠cone para acessar as diferentes funcionalidades do sistema." },
        { keywords: ["pagina inicial"], reply: "A p√°gina inicial √© o Dashboard. Ela oferece uma vis√£o geral do status da sua opera√ß√£o." },
        { keywords: ["configuracoes", "configurar"], reply: "As configura√ß√µes do sistema permitem personalizar fluxos de trabalho, notifica√ß√µes e outras funcionalidades. Apenas o administrador tem acesso a essa tela." },
        { keywords: ["ajuda", "suporte", "duvidas"], reply: "Se voc√™ n√£o encontrar a resposta que procura, pode entrar em contato com o suporte t√©cnico atrav√©s do bot√£o de ajuda no menu." },
        { keywords: ["manual do usuario", "tutorial"], reply: "O manual do usu√°rio est√° dispon√≠vel no menu de ajuda e cont√©m tutoriais detalhados sobre todas as funcionalidades do sistema." },
        { keywords: ["guia de inicio rapido", "guia rapido"], reply: "O guia de in√≠cio r√°pido te ajuda a dar os primeiros passos no sistema, desde o login at√© a cria√ß√£o de seu primeiro chamado." },
        { keywords: ["atalhos do teclado"], reply: "O sistema possui atalhos de teclado para agilizar o trabalho. Por exemplo, 'Ctrl + N' pode abrir um novo chamado." },
        { keywords: ["versao do sistema", "atualizacao"], reply: "Para ver a vers√£o atual do sistema, v√° at√© a tela 'Sobre'. As atualiza√ß√µes s√£o lan√ßadas regularmente com novas funcionalidades e melhorias." },
        { keywords: ["novidades"], reply: "As novidades sobre a plataforma e as pr√≥ximas atualiza√ß√µes s√£o comunicadas no blog oficial da InovaTech." },
        { keywords: ["email", "e-mail"], reply: "O e-mail do usu√°rio √© uma informa√ß√£o obrigat√≥ria para login e pode ser alterado na tela de edi√ß√£o do usu√°rio." },
        { keywords: ["fallback"], reply: "Desculpe, n√£o entendi. Por favor, tente perguntar de outra forma, como 'como criar usu√°rio' ou 'o que √© dashboard'." },
        { keywords: ["como alterar senha", "mudar senha", "alterar minha senha"], reply: "Para alterar sua senha, v√° para 'Meu Perfil' no menu de usu√°rio. L√°, voc√™ encontrar√° a op√ß√£o para criar uma nova senha. Lembre-se de usar uma senha forte, com letras, n√∫meros e s√≠mbolos." },
        { keywords: ["esqueci a senha", "redefinir senha", "recuperar senha", "perdi a senha"], reply: "Se voc√™ esqueceu sua senha, o administrador do sistema pode redefinir uma nova para voc√™. Por motivos de seguran√ßa, eu n√£o posso fazer isso diretamente. Por favor, entre em contato com sua equipe de TI ou o gestor respons√°vel." },
        { keywords: ["minha senha n√£o funciona", "erro de senha", "senha invalida"], reply: "Verifique se a senha foi digitada corretamente, incluindo letras mai√∫sculas e min√∫sculas. Se o problema persistir, pode ser necess√°rio redefinir sua senha com a ajuda de um administrador." },
        { keywords: ["senha segura", "como criar senha forte", "melhor senha"], reply: "Uma senha segura deve ter no m√≠nimo 8 caracteres, com uma combina√ß√£o de letras mai√∫sculas, min√∫sculas, n√∫meros e s√≠mbolos (!@#$). Evite usar datas de nascimento ou nomes f√°ceis de adivinhar." },
        { keywords: ["validade da senha", "senha expirou"], reply: "A sua senha tem um prazo de validade por quest√µes de seguran√ßa. Voc√™ receber√° uma notifica√ß√£o quando ela estiver perto de expirar. Fique atento para alter√°-la antes do prazo." },
        { keywords: ["login e senha", "acesso"], reply: "Seu login √© o seu e-mail de cadastro. Use-o junto com sua senha para acessar o sistema. Se tiver problemas, verifique se seu usu√°rio n√£o est√° inativo ou bloqueado." },
        { keywords: ["quantas vezes posso errar a senha", "senha bloqueada"], reply: "Ap√≥s um certo n√∫mero de tentativas de senha incorretas, sua conta ser√° bloqueada temporariamente por seguran√ßa. Isso impede acessos n√£o autorizados." },
        { keywords: ["notifica√ß√£o de senha", "alerta de senha"], reply: "O sistema envia alertas quando sua senha precisa ser alterada ou quando h√° tentativas de login suspeitas. Sempre verifique seu e-mail para esses avisos." },
        { keywords: ["senha temporaria"], reply: "Uma senha tempor√°ria √© geralmente fornecida quando sua senha √© redefinida por um administrador. Voc√™ deve us√°-la apenas para o primeiro login e alter√°-la imediatamente para uma senha de sua prefer√™ncia." },
        { keywords: ["posso usar a mesma senha de outros sites"], reply: "Para sua seguran√ßa, **n√£o √© recomendado** usar a mesma senha em sites diferentes. Crie senhas √∫nicas para cada sistema para evitar que, se uma for comprometida, as outras tamb√©m sejam." }
        ];

    // Fun√ß√£o para normalizar texto (sem acentos e em min√∫sculas)
    function normalizeText(text) {
        return text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    // Fun√ß√£o para adicionar uma nova mensagem na tela
    function addMessage(sender, text) {
        const msg = document.createElement("div");
        msg.className = `chat-message ${sender}`;
        msg.innerHTML = text;
        chatMessages.appendChild(msg);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Fun√ß√£o para renderizar os bot√µes de sugest√£o
    function renderSuggestions() {
        suggestionButtonsContainer.innerHTML = ''; // Limpa bot√µes antigos
        suggestions.forEach(text => {
            const button = document.createElement("button");
            button.className = "suggestion-btn";
            button.innerText = text;
            button.addEventListener("click", () => {
                userInput.value = text;
                sendBtn.click(); // Simula o clique no bot√£o Enviar
            });
            suggestionButtonsContainer.appendChild(button);
        });
    }

    // Fun√ß√£o para encontrar a resposta do bot
    function getBotResponse(message) {
        const normalizedMessage = normalizeText(message);
        for (const item of responses) {
            for (const keyword of item.keywords) {
                if (normalizedMessage.includes(keyword)) {
                    if (Array.isArray(item.reply)) {
                        const randomIndex = Math.floor(Math.random() * item.reply.length);
                        return item.reply[randomIndex];
                    }
                    return item.reply;
                }
            }
        }
        return responses.find(item => item.keywords.includes("fallback")).reply;
    }

    // Mensagem inicial do bot + Sugest√µes
    setTimeout(() => {
        addMessage("bot", "Ol√°! Eu sou a Intelig√™ncia Artificial da InovaTech. Posso te ajudar com d√∫vidas sobre usu√°rios, relat√≥rios, chamados e muito mais.");
        renderSuggestions(); // Exibe os bot√µes de sugest√£o
    }, 500);

    // Fun√ß√£o para adicionar uma nova mensagem na tela com data e hora
    function addMessage(sender, text) {
        const now = new Date();
        const formattedTime = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const formattedDate = now.toLocaleDateString('pt-BR');

        const msg = document.createElement("div");
        msg.className = `chat-message ${sender}`;
        
        // Cria o conte√∫do da mensagem com a data e hora
        const messageText = document.createElement("span");
        messageText.innerHTML = text;

        const messageInfo = document.createElement("span");
        messageInfo.className = "chat-message-info";
        messageInfo.innerText = `${formattedTime} ¬∑ ${formattedDate}`;

        msg.appendChild(messageText);
        msg.appendChild(messageInfo);
        
        chatMessages.appendChild(msg);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // A√ß√£o ao enviar o formul√°rio
    chatForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const message = userInput.value.trim();
        if (!message) return;

        addMessage("user", message);
        userInput.value = "";
        suggestionButtonsContainer.innerHTML = ''; // Esconde os bot√µes ao enviar

        const typingIndicator = document.createElement("div");
        typingIndicator.className = "chat-message bot typing-indicator";
        chatMessages.appendChild(typingIndicator);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        setTimeout(() => {
            typingIndicator.remove();
            const botReply = getBotResponse(message);
            addMessage("bot", botReply);
        }, 800);
    });
});