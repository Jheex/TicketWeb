@{
    ViewData["Title"] = "Chatbot";
}

<link rel="stylesheet" href="~/css/Chatbot.css" />

<div class="chatbot-page">
    <div class="chat-container">
        <h2>ðŸ’¬ Chatbot InovaTech</h2>
        <div class="chatbox">
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Digite sua mensagem..." />
                <button id="send-btn">Enviar</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ReferÃªncias aos elementos do DOM
    const sendBtn = document.getElementById("send-btn");
    const userInput = document.getElementById("user-input");
    const chatMessages = document.getElementById("chat-messages");

    // Array de respostas do chatbot, com palavras-chave e a resposta correspondente
    const responses = [
        // Respostas de alta prioridade (frases exatas ou palavras-chave muito especÃ­ficas)
        { keywords: ["oi", "olÃ¡", "ola", "oi tudo bem", "ola tudo bem"], reply: "OlÃ¡! Como posso te ajudar hoje?" },
        { keywords: ["como criar usuÃ¡rio", "como adicionar usuario"], reply: "VocÃª pode criar um novo usuÃ¡rio clicando no botÃ£o âž• Novo UsuÃ¡rio no topo da lista de usuÃ¡rios." },
        { keywords: ["como editar usuario", "como alterar dados"], reply: "Para editar um usuÃ¡rio, clique no botÃ£o 'Editar' na tabela correspondente." },
        { keywords: ["como excluir usuario", "como remover usuario"], reply: "Para remover um usuÃ¡rio, clique no botÃ£o 'Remover' na tabela." },
        { keywords: ["como ver os relatÃ³rios", "onde ver relatÃ³rios"], reply: "Para ver os relatÃ³rios, navegue atÃ© a tela de Dashboard. LÃ¡, vocÃª pode filtrar e visualizar dados de chamados e KPIs." },
        { keywords: ["como alterar senha"], reply: "Se precisar alterar a senha, vÃ¡ na tela de ediÃ§Ã£o do usuÃ¡rio e preencha o campo de senha." },

        // Respostas de mÃ©dia prioridade (palavras-chave gerais)
        { keywords: ["usuÃ¡rio", "usuarios", "criar", "novo", "adicionar", "cadastro"], reply: "O sistema permite criar, editar e remover usuÃ¡rios. Se precisar de ajuda com uma aÃ§Ã£o especÃ­fica, me diga 'como criar usuÃ¡rio' ou 'como editar usuÃ¡rio'." },
        { keywords: ["editar", "alterar", "modificar"], reply: "As opÃ§Ãµes de ediÃ§Ã£o estÃ£o disponÃ­veis na tabela. Qual item vocÃª gostaria de editar?" },
        { keywords: ["remover", "excluir", "deletar", "apagar"], reply: "VocÃª pode remover itens diretamente na tabela de listagem." },
        { keywords: ["senha", "password", "login"], reply: "A senha pode ser alterada na tela de ediÃ§Ã£o do usuÃ¡rio." },
        { keywords: ["email"], reply: "O email do usuÃ¡rio pode ser preenchido ao criar ou editar usuÃ¡rios." },
        { keywords: ["lista", "tabela", "visualizar"], reply: "A tabela de dados mostra informaÃ§Ãµes detalhadas. VocÃª pode usar a paginaÃ§Ã£o para navegar entre as pÃ¡ginas." },
        { keywords: ["paginaÃ§Ã£o", "pÃ¡ginas", "navegar"], reply: "Use os nÃºmeros na parte inferior da tabela para navegar entre as pÃ¡ginas." },
        { keywords: ["relatÃ³rios", "dashboard", "report", "estatÃ­sticas"], reply: "Os relatÃ³rios e estatÃ­sticas estÃ£o na tela de Dashboard. LÃ¡ vocÃª encontra KPIs de chamados e outras informaÃ§Ãµes importantes." },
        { keywords: ["chamado", "chamados"], reply: "A tela de Dashboard mostra os chamados e permite filtrar por status, prioridade ou analista. Qual informaÃ§Ã£o vocÃª precisa?" },
        { keywords: ["ajuda", "suporte", "problema", "erro", "dÃºvida"], reply: "Claro! Pergunte qualquer coisa sobre o sistema que eu tentarei te ajudar." },
        { keywords: ["obrigado", "valeu", "show"], reply: "De nada! Fico feliz em ajudar." }
    ];

    // FunÃ§Ã£o para encontrar a resposta do bot com base na mensagem do usuÃ¡rio
    function getBotResponse(message) {
        // Normaliza a mensagem para busca (lowercase, sem acentos)
        const normalizedMessage = message.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

        // Tenta encontrar uma resposta correspondente
        for (const item of responses) {
            for (const keyword of item.keywords) {
                if (normalizedMessage.includes(keyword)) {
                    return item.reply;
                }
            }
        }

        // Resposta padrÃ£o caso nenhuma palavra-chave seja encontrada
        return "Desculpe, nÃ£o entendi sua pergunta. Tente reformular ou ser mais especÃ­fico.";
    }

    // FunÃ§Ã£o para adicionar uma nova mensagem na tela
    function addMessage(sender, text) {
        const msg = document.createElement("div");
        msg.className = "chat-message " + sender;
        msg.innerText = text;
        chatMessages.appendChild(msg);
        chatMessages.scrollTop = chatMessages.scrollHeight; // Rola a tela para a Ãºltima mensagem
    }

    // AÃ§Ã£o ao clicar no botÃ£o "Enviar"
    sendBtn.addEventListener("click", () => {
        const message = userInput.value.trim();
        if (!message) return; // NÃ£o envia se a mensagem estiver vazia

        // Adiciona a mensagem do usuÃ¡rio
        addMessage("user", message);
        userInput.value = ""; // Limpa a caixa de texto

        // Adiciona o indicador de 'digitando...'
        const typingIndicator = document.createElement("div");
        typingIndicator.className = "chat-message bot typing-indicator";
        chatMessages.appendChild(typingIndicator);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        // Simula um pequeno delay (0.8 segundos) para a resposta do bot
        setTimeout(() => {
            typingIndicator.remove(); // Remove o indicador de 'digitando...'
            const botReply = getBotResponse(message);
            addMessage("bot", botReply); // Adiciona a resposta do bot
        }, 800);
    });

    // AÃ§Ã£o ao pressionar a tecla "Enter"
    userInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") sendBtn.click();
    });
</script>